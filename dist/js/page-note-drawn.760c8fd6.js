(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-note-drawn"],{"1b66":function(t,e,s){"use strict";var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["redraw"]="redraw",t["fill"]="fill",t["mouseup"]="mouseup",t["mousedown"]="mousedown",t["mouseenter"]="mouseenter",t["mouseleave"]="mouseleave"}(o=e.AllowedEvents||(e.AllowedEvents={}));var i=function(){function t(t){var e=t.elementId,s=t.width,o=t.height,i=t.backgroundColor,n=void 0===i?[255,255,255]:i,a=t.lineWidth,r=void 0===a?5:a,h=t.strokeColor,c=void 0===h?[0,0,0]:h,d=t.disabled,l=t.showWarnings,u=void 0!==l&&l,v=t.maxSnapshots,p=void 0===v?10:v;if(this.requiredParam(t,"elementId"),this.requiredParam(t,"width"),this.requiredParam(t,"height"),this.elementId=e,this.canvasNode=document.getElementById(this.elementId),this.canvasNode instanceof HTMLCanvasElement)this.canvas=this.canvasNode;else{if(!(this.canvasNode instanceof HTMLElement))throw new Error("No element found with following id: "+this.elementId);var f=document.createElement("canvas");this.canvasNode.appendChild(f),this.canvas=f}this.context=this.canvas.getContext("2d"),this.width=s,this.height=o,this.maxSnapshots=p,this.snapshots=[],this.undos=[],this.positions=[],this.leftCanvasDrawing=!1,this.isDrawing=!1,this.isDrawingModeEnabled=!0,this.imageRestored=!1,this.lineWidth=r,this.strokeColor=this.toValidColor(c),this.bucketToolColor=this.toValidColor(c),this.bucketToolTolerance=0,this.isBucketToolEnabled=!1,this.listenersList=["mouseDown","mouseMove","mouseLeave","mouseUp","touchStart","touchMove","touchEnd"],this.allowedEvents=this.getAllowedEvents(),this.redrawCounter=0,this.dispatchEventsOnceEvery=0,this.events={redrawEvent:new Event("cfd_redraw"),fillEvent:new Event("cfd_fill"),mouseUpEvent:new Event("cfd_mouseup"),mouseDownEvent:new Event("cfd_mousedown"),mouseEnterEvent:new Event("cfd_mouseenter"),mouseLeaveEvent:new Event("cfd_mouseleave"),touchStartEvent:new Event("cfd_touchstart"),touchEndEvent:new Event("cfd_touchend")},this.bindings={mouseDown:this.mouseDown.bind(this),mouseMove:this.mouseMove.bind(this),mouseLeave:this.mouseLeave.bind(this),mouseUp:this.mouseUp.bind(this),mouseUpDocument:this.mouseUpDocument.bind(this),touchStart:this.touchStart.bind(this),touchMove:this.touchMove.bind(this),touchEnd:this.touchEnd.bind(this)},this.touchIdentifier=void 0,this.previousX=void 0,this.previousY=void 0,this.showWarnings=u,this.isNodeColorEqualCache={},this.setDimensions(),this.setBackground(n),this.storeSnapshot(),d||this.enableDrawingMode()}return t.prototype.requiredParam=function(t,e){if(!t||!t[e])throw new Error(e+" is required")},t.prototype.logWarning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.showWarnings&&console.warn.apply(console,t)},t.prototype.addListeners=function(){var t=this;this.listenersList.forEach(function(e){t.canvas.addEventListener(e.toLowerCase(),t.bindings[e])}),document.addEventListener("mouseup",this.bindings.mouseUpDocument)},t.prototype.removeListeners=function(){var t=this;this.listenersList.forEach(function(e){t.canvas.removeEventListener(e.toLowerCase(),t.bindings[e])}),document.removeEventListener("mouseup",this.bindings.mouseUpDocument)},t.prototype.getAllowedEvents=function(){var t=[];for(var e in o)t.push(e);return t},t.prototype.enableDrawingMode=function(){return this.isDrawingModeEnabled=!0,this.addListeners(),this.toggleCursor(),this.isDrawingModeEnabled},t.prototype.disableDrawingMode=function(){return this.isDrawingModeEnabled=!1,this.removeListeners(),this.toggleCursor(),this.isDrawingModeEnabled},t.prototype.mouseDown=function(t){if(0===t.button){var e=t.pageX-this.canvas.offsetLeft,s=t.pageY-this.canvas.offsetTop;this.drawPoint(e,s)}},t.prototype.mouseMove=function(t){var e=t.pageX-this.canvas.offsetLeft,s=t.pageY-this.canvas.offsetTop;this.drawLine(e,s,t)},t.prototype.touchStart=function(t){if(t.changedTouches.length>0){var e=t.changedTouches[0],s=e.pageX,o=e.pageY,i=e.identifier,n=s-this.canvas.offsetLeft,a=o-this.canvas.offsetTop;this.touchIdentifier=i,this.drawPoint(n,a)}},t.prototype.touchMove=function(t){if(t.changedTouches.length>0){var e=t.changedTouches[0],s=e.pageX,o=e.pageY,i=e.identifier,n=s-this.canvas.offsetLeft,a=o-this.canvas.offsetTop;if(i!=this.touchIdentifier)return;this.previousX=n,this.previousY=a,this.drawLine(n,a,t)}},t.prototype.touchEnd=function(){this.handleEndDrawing(),this.canvas.dispatchEvent(this.events.touchEndEvent)},t.prototype.mouseUp=function(){this.handleEndDrawing(),this.canvas.dispatchEvent(this.events.mouseUpEvent)},t.prototype.mouseUpDocument=function(){this.leftCanvasDrawing=!1},t.prototype.mouseLeave=function(){this.isDrawing&&(this.leftCanvasDrawing=!0),this.isDrawing=!1,this.canvas.dispatchEvent(this.events.mouseLeaveEvent)},t.prototype.mouseEnter=function(){this.canvas.dispatchEvent(this.events.mouseEnterEvent)},t.prototype.handleEndDrawing=function(){this.isDrawing=!1,this.storeSnapshot()},t.prototype.drawPoint=function(t,e){this.isBucketToolEnabled?this.fill(t,e,this.bucketToolColor,{tolerance:this.bucketToolTolerance}):(this.isDrawing=!0,this.storeDrawing(t,e,!1),this.canvas.dispatchEvent(this.events.mouseDownEvent),this.handleDrawing())},t.prototype.drawLine=function(t,e,s){this.leftCanvasDrawing&&(this.leftCanvasDrawing=!1,s instanceof MouseEvent?this.mouseDown(s):s instanceof TouchEvent&&this.touchEnd()),this.isDrawing&&(this.storeDrawing(t,e,!0),this.handleDrawing(this.dispatchEventsOnceEvery))},t.prototype.handleDrawing=function(t){var e=this;this.context.lineJoin="round";var s=[this.positions.slice().pop()];s.forEach(function(t){t&&t[0]&&t[0].strokeColor&&(e.context.strokeStyle=e.rgbaFromArray(t[0].strokeColor),e.context.lineWidth=t[0].lineWidth,e.draw(t))}),t?this.redrawCounter%t===0&&this.canvas.dispatchEvent(this.events.redrawEvent):this.canvas.dispatchEvent(this.events.redrawEvent),this.undos=[],this.redrawCounter+=1},t.prototype.draw=function(t){var e=this;t.forEach(function(s,o){var i=s.x,n=s.y,a=s.moving;e.context.beginPath(),a&&o?e.context.moveTo(t[o-1]["x"],t[o-1]["y"]):e.context.moveTo(i-1,n),e.context.lineTo(i,n),e.context.closePath(),e.context.stroke()})},t.prototype.fill=function(t,e,s,o){var i=o.tolerance;if(s=this.toValidColor(s),0===this.positions.length&&!this.imageRestored)return this.setBackground(s,!1),this.canvas.dispatchEvent(this.events.redrawEvent),void this.canvas.dispatchEvent(this.events.fillEvent);var n=this.width*this.height,a=this.context.getImageData(0,0,this.width,this.height),r=a.data,h=this.getNodeColor(t,e,r);if(!this.isNodeColorEqual(h,s,i)){var c=[];c.push([t,e]);while(c.length){if(c.length>n)break;var d=c.pop(),l=d,u=d;while(this.isNodeColorEqual(this.getNodeColor(l[0]-1,l[1],r),h,i))l=[l[0]-1,l[1]];while(this.isNodeColorEqual(this.getNodeColor(u[0]+1,u[1],r),h,i))u=[u[0]+1,u[1]];for(var v=l[0],p=u[0],f=v;f<=p;f++)this.setNodeColor(f,l[1],s,r),this.isNodeColorEqual(this.getNodeColor(f,l[1]+1,r),h,i)&&c.push([f,l[1]+1]),this.isNodeColorEqual(this.getNodeColor(f,l[1]-1,r),h,i)&&c.push([f,l[1]-1])}this.context.putImageData(a,0,0),this.canvas.dispatchEvent(this.events.redrawEvent),this.canvas.dispatchEvent(this.events.fillEvent)}},t.prototype.toValidColor=function(t){if(Array.isArray(t)&&4===t.length&&t.pop(),Array.isArray(t)&&3===t.length){var e=t.slice();return e.push(255),e}return this.logWarning("Color is not valid!\nIt must be an array with RGB values:  [0-255, 0-255, 0-255]"),[0,0,0,255]},t.prototype.isNodeColorEqual=function(t,e,s){var o=""+t[0]+t[1]+t[2]+t[3],i=""+e[0]+e[1]+e[2]+e[3],n=o+i+s;if(s=s||0,this.isNodeColorEqualCache.hasOwnProperty(o+i+s))return this.isNodeColorEqualCache[n];var a=Math.abs(e[0]-t[0]),r=Math.abs(e[1]-t[1]),h=Math.abs(e[2]-t[2]),c=a/255,d=r/255,l=h/255,u=(c+d+l)/3*100,v=s>=u;return this.isNodeColorEqualCache[n]=v,v},t.prototype.getNodeColor=function(t,e,s){var o=4*(t+e*this.width);return[s[o],s[o+1],s[o+2],s[o+3]]},t.prototype.setNodeColor=function(t,e,s,o){var i=4*(t+e*this.width);o[i]=s[0],o[i+1]=s[1],o[i+2]=s[2],o[i+3]=s[3]},t.prototype.rgbaFromArray=function(t){return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},t.prototype.setDimensions=function(){this.canvas.height=this.height,this.canvas.width=this.width},t.prototype.toggleCursor=function(){this.canvas.style.cursor=this.isDrawingModeEnabled?"crosshair":"auto"},t.prototype.storeDrawing=function(t,e,s){if(s){var o=this.positions.length-1;this.positions[o].push({x:t,y:e,moving:s,lineWidth:this.lineWidth,strokeColor:this.strokeColor,isBucket:!1})}else this.positions.push([{x:t,y:e,isBucket:!1,moving:s,lineWidth:this.lineWidth,strokeColor:this.strokeColor}])},t.prototype.storeSnapshot=function(){var t=this.getCanvasSnapshot();this.snapshots.push(t),this.snapshots.length>this.maxSnapshots&&(this.snapshots=this.snapshots.splice(-Math.abs(this.maxSnapshots)))},t.prototype.getCanvasSnapshot=function(){return this.context.getImageData(0,0,this.width,this.height)},t.prototype.restoreCanvasSnapshot=function(t){this.context.putImageData(t,0,0)},t.prototype.on=function(t,e){var s=t.event,o=t.counter;this.requiredParam(t,"event"),this.allowedEvents.includes(s)?("redraw"===s&&o&&Number.isInteger(o)&&(this.dispatchEventsOnceEvery=o),this.canvas.addEventListener("cfd_"+s,function(){return e()})):this.logWarning("This event is not allowed: "+s)},t.prototype.setLineWidth=function(t){this.lineWidth=t},t.prototype.setBackground=function(t,e){void 0===e&&(e=!0);var s=this.toValidColor(t);s&&(e&&(this.backgroundColor=s),this.context.fillStyle=this.rgbaFromArray(s),this.context.fillRect(0,0,this.width,this.height))},t.prototype.setDrawingColor=function(t){this.configBucketTool({color:t}),this.setStrokeColor(t)},t.prototype.setStrokeColor=function(t){this.strokeColor=this.toValidColor(t)},t.prototype.configBucketTool=function(t){var e=t.color,s=void 0===e?null:e,o=t.tolerance,i=void 0===o?null:o;s&&(this.bucketToolColor=this.toValidColor(s)),i&&i>0&&(this.bucketToolTolerance=i>100?100:i)},t.prototype.toggleBucketTool=function(){return this.isBucketToolEnabled=!this.isBucketToolEnabled},t.prototype.toggleDrawingMode=function(){return this.isDrawingModeEnabled?this.disableDrawingMode():this.enableDrawingMode()},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height),this.positions=[],this.imageRestored=!1,this.backgroundColor&&this.setBackground(this.backgroundColor),this.handleEndDrawing()},t.prototype.save=function(){return this.canvas.toDataURL()},t.prototype.restore=function(t,e){var s=this,o=new Image;o.src=t,o.onload=function(){s.imageRestored=!0,s.context.drawImage(o,0,0),"function"===typeof e&&e()}},t.prototype.undo=function(){var t=this.snapshots[this.snapshots.length-1],e=this.snapshots[this.snapshots.length-2];e?(this.restoreCanvasSnapshot(e),this.snapshots.pop(),this.undos.push(t),this.undos=this.undos.splice(-Math.abs(this.maxSnapshots)),this.imageRestored=!0):this.logWarning("There are no more undos left.")},t.prototype.redo=function(){if(this.undos.length>0){var t=this.undos.pop();t&&(this.restoreCanvasSnapshot(t),this.snapshots.push(t),this.snapshots=this.snapshots.splice(-Math.abs(this.maxSnapshots)))}else this.logWarning("There are no more redo left.")},t}();e.default=i},8441:function(t,e,s){"use strict";var o=s("9007"),i=s.n(o);i.a},9007:function(t,e,s){},"9cf3":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"note-drawn"},[s("div",{staticClass:"drawning-area",attrs:{id:"note-drawning"}}),s("b-container",{staticClass:"drawn-options border-top border-secondary",attrs:{fluid:""}},[s("div",{staticClass:"line-options text-center"},[s("div",{staticClass:"line-colors"},[s("div",{staticClass:"colors-container"},t._l(t.colors,function(e,o){return s("div",{key:o,staticClass:"color-item"},[s("div",{staticClass:"color-select",style:{"background-color":"rgb("+e.join(", ")+")"},on:{click:function(e){return t.selectColor(o)}}})])}),0)]),s("div",{staticClass:"line-size d-flex"},[s("div",{staticClass:"size-ajust",on:{click:t.decrementSize}},[t._v("-")]),s("div",{staticClass:"size-value"},[t._v(t._s(t.size)+"px")]),s("div",{staticClass:"size-ajust",on:{click:t.incrementSize}},[t._v("+")])])]),s("div",{staticClass:"actions text-right"},[s("div",{staticStyle:{flex:"1"}},[s("b-button",{attrs:{disable:t.buttonBlock,variant:"light",size:"sm"},on:{click:t.undo}},[s("i",{staticClass:"material-icons"},[t._v("undo")])]),t._v("\n                 \n                "),s("b-button",{attrs:{disable:t.buttonBlock,variant:"warning",size:"sm"},on:{click:t.discardChanges}},[t._v("\n                    Discard\n                ")]),t._v("\n                 \n                "),s("b-button",{attrs:{disable:t.buttonBlock,variant:"success",size:"sm"},on:{click:t.save}},[t._v("Save")])],1)])])],1)},i=[],n=s("1b66"),a=s.n(n),r={name:"note-drawn",data:function(){return{drawn:null,size:3,color:"light",colors:{light:[248,249,250],primary:[0,123,255],secondary:[108,117,125],success:[40,167,69],warning:[255,193,7],danger:[220,53,69]},buttonBlock:!1}},mounted:function(){var t=this,e=document.querySelector(".note-drawn .drawning-area");this.drawn=new a.a({elementId:"note-drawning",width:e.offsetWidth,height:e.offsetHeight-5,backgroundColor:[0,0,0],lineWidth:this.size,strokeColor:this.colors[this.color]});var s=this.$route.params.id;s&&(window.ipcRenderer.once("note-get-reply",function(e,s){t.drawn.restore(s.content,function(){t.drawn.storeSnapshot(),t.drawn.snapshots.splice(0,1)})}),window.ipcRenderer.send("note-get",s))},methods:{selectColor:function(t){this.color=t,this.drawn.setStrokeColor(this.colors[this.color])},incrementSize:function(){this.size=this.size+1,this.drawn.setLineWidth(this.size)},decrementSize:function(){this.size>1&&(this.size=this.size-1,this.drawn.setLineWidth(this.size))},undo:function(){this.drawn.undo()},discardChanges:function(){window.history.length>1?this.$router.go(-1):this.$router.push("/")},save:function(){var t=this;this.buttonBlock=!0,window.ipcRenderer.once("note-drawn-save-reply",function(){t.discardChanges()}),window.ipcRenderer.send("note-drawn-save",{id:this.$route.params.id,content:this.drawn.save()})}}},h=r,c=(s("8441"),s("2877")),d=Object(c["a"])(h,o,i,!1,null,"3a121692",null);e["default"]=d.exports}}]);
//# sourceMappingURL=page-note-drawn.760c8fd6.js.map